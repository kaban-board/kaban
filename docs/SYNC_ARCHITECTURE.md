# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: CLI/TUI ‚Üî Web —á–µ—Ä–µ–∑ Turso

## –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                              TURSO CLOUD                                ‚îÇ
‚îÇ                    (–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)                             ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Database: kaban-web-poc                                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - boards                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - columns                                                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - tasks                                                        ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚Üë‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                               ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   CLI / TUI (Local)   ‚îÇ       ‚îÇ   Web (Cloudflare)    ‚îÇ
        ‚îÇ                       ‚îÇ       ‚îÇ                       ‚îÇ
        ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ       ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
        ‚îÇ ‚îÇ Embedded Replica  ‚îÇ ‚îÇ       ‚îÇ ‚îÇ Direct HTTP       ‚îÇ ‚îÇ
        ‚îÇ ‚îÇ (local.db)        ‚îÇ ‚îÇ       ‚îÇ ‚îÇ (libsql://...)    ‚îÇ ‚îÇ
        ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ       ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
        ‚îÇ        ‚Üì sync         ‚îÇ       ‚îÇ                       ‚îÇ
        ‚îÇ   (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π)     ‚îÇ       ‚îÇ   (—Ä–µ–∞–ª-—Ç–∞–π–º)         ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### 1. CLI/TUI (–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ + Sync)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```json
// .kaban/config.json
{
  "driver": "libsql",
  "url": "file:.kaban/local.db",
  "syncUrl": "libsql://kaban-web-poc-beshkenadze.aws-eu-west-1.turso.io",
  "authToken": "...",
  "syncInterval": 30000
}
```

**Workflow:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω–æ–π SQLite (offline-first)
2. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π sync —Å Turso (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
3. –î—Ä—É–≥–∏–µ –∫–ª–∏–µ–Ω—Ç—ã (Web/CLI) –≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Turso

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
kaban sync                    # –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
kaban sync --watch           # –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
kaban sync --force           # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–ª–Ω—ã–π sync
```

### 2. Web (Cloudflare Workers)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```typescript
// lib/db-cloudflare.ts
import { connect } from '@tursodatabase/serverless';

export function createDB() {
  return connect({
    url: process.env.TURSO_DATABASE_URL,      // libsql://...
    authToken: process.env.TURSO_AUTH_TOKEN,
  });
}
```

**Workflow:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Turso —á–µ—Ä–µ–∑ HTTP
3. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É –≤ –æ–±–ª–∞–∫–µ
4. CLI/TUI –ø–æ–ª—É—á–∞—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º sync

### 3. Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Web ‚Üí CLI/TUI:**
```typescript
// Web: –æ—Ç–ø—Ä–∞–≤–∫–∞ webhook –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
const notifyChange = async (boardId: string) => {
  await fetch('/api/notify', {
    method: 'POST',
    body: JSON.stringify({ boardId, timestamp: Date.now() })
  });
};
```

**CLI/TUI: polling/long-polling**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
setInterval(async () => {
  const lastSync = await getLastSyncTime();
  const changes = await db.sync({
    syncUrl: config.syncUrl,
    since: lastSync
  });
  if (changes.length > 0) {
    notifyUser('–î–æ—Å–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
  }
}, 5000);
```

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–∞–±–æ—Ç–∞ –≤ CLI, –ø—Ä–æ—Å–º–æ—Ç—Ä –≤ Web

```
1. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (CLI):
   $ kaban add "Fix bug #123"
   
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π sync —Å Turso (30 —Å–µ–∫)

3. –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
   https://kaban.board/board/demo
   
4. –í–∏–¥–∏—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É "Fix bug #123"
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–∞–±–æ—Ç–∞ –≤ Web, offline –≤ CLI

```
1. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –¥–æ—Ä–æ–≥–µ (–Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞):
   $ kaban list                    # —Ä–∞–±–æ—Ç–∞–µ—Ç —Å local.db
   
2. –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É:
   $ kaban add "Review PR #456"
   
3. –ü—Ä–∏—Ö–æ–¥–∏—Ç –¥–æ–º–æ–π (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ—è–≤–∏–ª—Å—è):
   $ kaban sync                    # –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Turso
   
4. Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—è

```
1. Developer A (CLI): kaban add "Task 1"
2. Developer B (Web): –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –≤ "In Progress"
3. Developer A: kaban sync ‚Üí –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. Developer B: –≤–∏–¥–∏—Ç Task 1 –≤ In Progress (real-time)
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π

### Development (Local)

```bash
# Web (Next.js dev)
TURSO_DATABASE_URL="file:./local.db"
TURSO_SYNC_URL="libsql://kaban-web-poc-beshkenadze.aws-eu-west-1.turso.io"

# CLI/TUI
.kaban/config.json ‚Üí local.db + syncUrl
```

### Production

```bash
# Web (Cloudflare)
TURSO_DATABASE_URL="libsql://kaban-web-poc-beshkenadze.aws-eu-west-1.turso.io"
TURSO_SYNC_URL="" (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

# CLI/TUI (—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
.kaban/config.json ‚Üí local.db + syncUrl
```

## Conflict Resolution

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è: Last-Write-Wins + Timestamp**

```typescript
// Task —Å –ø–æ–ª—è–º–∏:
interface Task {
  id: string;
  title: string;
  // ...
  updatedAt: number;     // Unix timestamp
  version: number;       // Incremental version
}

// –ü—Ä–∏ sync:
const resolveConflict = (local: Task, remote: Task) => {
  if (local.updatedAt > remote.updatedAt) {
    return local;  // –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–µ–µ
  }
  return remote;   // –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–µ–µ
};
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **Auth Token** ‚Äî –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Å–≤–æ–π —Ç–æ–∫–µ–Ω
2. **Board Access** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
3. **Rate Limiting** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ sync (Turso –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)

## TODO –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Web (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ZenStack API —Å Turso
- [ ] –î–æ–±–∞–≤–∏—Ç—å real-time polling (5 —Å–µ–∫)
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "syncing..."
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ offline-—Ä–µ–∂–∏–º–∞ (Service Worker)

### CLI/TUI (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- [ ] –ö–æ–º–∞–Ω–¥–∞ `kaban sync` —Å –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º sync
- [ ] –ê–≤—Ç–æ-sync –≤ —Ñ–æ–Ω–µ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [ ] Conflict resolution UI

### Shared (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- [ ] WebSocket/SSE –¥–ª—è real-time (–≤–º–µ—Å—Ç–æ polling)
- [ ] Offline queue –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] Compress sync data

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. CLI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç
$ kaban init --turso --url libsql://... --token ...

# 2. –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
$ kaban add "Task 1"

# 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç
$ kaban sync

# 4. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
$ open https://kaban.board/board/demo
```

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
